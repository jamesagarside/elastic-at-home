# Dynamic Configuration - Direct Access Mode
# Contains TLS certificates, serversTransports, and port-based routers/services

tls:
  certificates:
    - certFile: /certs/traefik/traefik.crt
      keyFile: /certs/traefik/traefik.key
  stores:
    default:
      defaultCertificate:
        certFile: /certs/traefik/traefik.crt
        keyFile: /certs/traefik/traefik.key

http:
  routers:
    es-direct:
      rule: "PathPrefix(`/`)"
      entryPoints:
        - elasticsearch
      service: es-service
      tls: {}

    kibana-direct:
      rule: "PathPrefix(`/`)"
      entryPoints:
        - kibana
      service: kibana-service
      tls: {}

    fleet-direct:
      rule: "PathPrefix(`/`)"
      entryPoints:
        - fleet
      service: fleet-service
      tls: {}

    apm-direct:
      rule: "PathPrefix(`/`)"
      entryPoints:
        - apm
      service: apm-service
      tls: {}

  services:
    es-service:
      loadBalancer:
        servers:
          - url: "https://es01:9200"
        serversTransport: es-transport

    kibana-service:
      loadBalancer:
        servers:
          - url: "https://kibana:5601"
        serversTransport: kibana-transport

    fleet-service:
      loadBalancer:
        servers:
          - url: "https://fleet-server:8220"
        serversTransport: fleet-transport

    apm-service:
      loadBalancer:
        servers:
          - url: "https://fleet-server:8200"
        serversTransport: fleet-transport

  serversTransports:
    es-transport:
      serverName: "es01"
      rootCAs:
        - /certs/ca/ca.crt

    kibana-transport:
      serverName: "kibana"
      rootCAs:
        - /certs/ca/ca.crt

    fleet-transport:
      serverName: "fleet-server"
      rootCAs:
        - /certs/ca/ca.crt
