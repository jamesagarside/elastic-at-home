# =============================================================================
# TRAEFIK DYNAMIC CONFIGURATION - Self-Signed Mode
# =============================================================================
#
# This file provides Traefik's dynamic configuration for self-signed certificate
# mode. Dynamic configuration can be changed without restarting Traefik.
#
# WHAT IS DYNAMIC VS STATIC CONFIGURATION?
#   - Static (traefik-selfsigned.yml): Entrypoints, providers, log settings
#   - Dynamic (this file): Certificates, routes, middleware, transport settings
#
# WHY SELF-SIGNED MODE?
#   Self-signed certificates work without external dependencies (no DNS, no
#   internet required). Ideal for:
#   - Home labs behind NAT
#   - Development environments
#   - Networks without public DNS
#
#   Trade-off: Browsers will show certificate warnings (you must trust the CA)
#
# =============================================================================

# =============================================================================
# TLS CERTIFICATES
# =============================================================================
# In self-signed mode, we provide the certificate Traefik uses for HTTPS.
# This certificate was generated by the setup container and includes all
# service domain names in its Subject Alternative Names (SANs).
# =============================================================================
tls:
  certificates:
    # The Traefik certificate is used for all incoming HTTPS connections
    # It's signed by our internal CA and valid for all configured domain names
    - certFile: /certs/traefik/traefik.crt
      keyFile: /certs/traefik/traefik.key

# =============================================================================
# SERVERS TRANSPORTS
# =============================================================================
# serversTransports define how Traefik connects to backend services over HTTPS.
# Since our backend services use certificates signed by our internal CA,
# Traefik needs to trust that CA to verify their certificates.
#
# WHY IS THIS NEEDED?
#   Traefik acts as a reverse proxy: Client → Traefik → Backend Service
#   The connection from Traefik to the backend is also HTTPS, so Traefik
#   must verify the backend's certificate. Without rootCAs, Traefik would
#   reject the connection as "certificate signed by unknown authority".
#
# serverName: Must match the CN or SAN in the backend's certificate
# rootCAs: Certificate authorities to trust for backend certificate verification
# =============================================================================
http:
  serversTransports:
    # Transport for connecting to Elasticsearch
    es-transport:
      serverName: "es01"        # Must match certificate's CN/SAN
      rootCAs:
        - /certs/ca/ca.crt      # Trust our internal CA

    # Transport for connecting to Kibana
    kibana-transport:
      serverName: "kibana"
      rootCAs:
        - /certs/ca/ca.crt

    # Transport for connecting to Fleet Server
    fleet-transport:
      serverName: "fleet-server"
      rootCAs:
        - /certs/ca/ca.crt
